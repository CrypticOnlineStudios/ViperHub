local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- GUI setup
local gui = Instance.new("ScreenGui")
gui.Name = "PersistentGUI"
gui.ResetOnSpawn = false -- This ensures it persists after death
gui.Parent = player:WaitForChild("PlayerGui")

-- Main frame and key box UI elements
local dragFrame = Instance.new("Frame")
local keyBox = Instance.new("TextBox")
local keySubmit = Instance.new("TextButton")
local copyKeyButton = Instance.new("TextButton")
local secondBox = Instance.new("Frame")
local minimizeButton = Instance.new("TextButton")
local closeButton = Instance.new("TextButton")

-- Configurations
local correctKey = "vipersigma123"
local fadeDuration = 0.5
local clipboardKey = "vipersigma123"

-- Styling for modern and smooth design
local function applyModernStyling(frame, radius, bgColor)
	frame.BackgroundColor3 = bgColor or Color3.fromRGB(45, 45, 45)
	frame.BorderSizePixel = 0
	frame.ClipsDescendants = true -- Rounded corners effect
	frame.Visible = false
	frame.AnchorPoint = Vector2.new(0.5, 0.5)
	frame.Position = UDim2.new(0.5, 0, 0.5, 0)

	local uicorner = Instance.new("UICorner")
	uicorner.CornerRadius = UDim.new(0, radius)
	uicorner.Parent = frame
end

-- Setup initial box
applyModernStyling(dragFrame, 10)
dragFrame.Size = UDim2.new(0, 350, 0, 200)
dragFrame.Parent = gui
dragFrame.Draggable = true
dragFrame.Active = true

-- KeyBox styling
keyBox.Size = UDim2.new(0, 300, 0, 40)
keyBox.Position = UDim2.new(0.5, 0, 0.3, 0)
keyBox.AnchorPoint = Vector2.new(0.5, 0.5)
keyBox.Text = "Enter Key"
keyBox.BackgroundTransparency = 0.1
keyBox.TextSize = 18
applyModernStyling(keyBox, 8)
keyBox.Parent = dragFrame

-- Key submit button
keySubmit.Size = UDim2.new(0, 150, 0, 40)
keySubmit.Position = UDim2.new(0.5, 0, 0.55, 0)
keySubmit.AnchorPoint = Vector2.new(0.5, 0.5)
keySubmit.Text = "Submit"
applyModernStyling(keySubmit, 8)
keySubmit.Parent = dragFrame

-- Copy key button
copyKeyButton.Size = UDim2.new(0, 200, 0, 40)
copyKeyButton.Position = UDim2.new(0.5, 0, 0.8, 0)
copyKeyButton.AnchorPoint = Vector2.new(0.5, 0.5)
copyKeyButton.Text = "Copy Key Access"
applyModernStyling(copyKeyButton, 8)
copyKeyButton.Parent = dragFrame

-- Second box styling
applyModernStyling(secondBox, 10)
secondBox.Size = UDim2.new(0, 350, 0, 200)
secondBox.Parent = gui
secondBox.Draggable = true
secondBox.Active = true

-- Minimize and close buttons
minimizeButton.Size = UDim2.new(0, 30, 0, 30)
minimizeButton.Position = UDim2.new(1, -60, 0, 10)
minimizeButton.Text = "-"
applyModernStyling(minimizeButton, 15)
minimizeButton.Parent = secondBox

closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -20, 0, 10)
closeButton.Text = "X"
applyModernStyling(closeButton, 15)
closeButton.Parent = secondBox

-- Functions for animations
local function fadeIn(frame)
	frame.Visible = true
	TweenService:Create(frame, TweenInfo.new(fadeDuration), {BackgroundTransparency = 0}):Play()
end

local function fadeOut(frame, callback)
	local tween = TweenService:Create(frame, TweenInfo.new(fadeDuration), {BackgroundTransparency = 1})
	tween:Play()
	tween.Completed:Connect(function()
		frame.Visible = false
		if callback then callback() end
	end)
end

local function showSecondBox()
	secondBox.Visible = true
	fadeIn(secondBox)
end

-- Copy key functionality
copyKeyButton.MouseButton1Click:Connect(function()
	setclipboard(clipboardKey)
end)

-- Key submission
keySubmit.MouseButton1Click:Connect(function()
	if keyBox.Text == correctKey then
		fadeOut(dragFrame, function()
			showSecondBox()
		end)
	end
end)

-- Minimize functionality
local isMinimized = false
minimizeButton.MouseButton1Click:Connect(function()
	if not isMinimized then
		secondBox:TweenSize(UDim2.new(0, 350, 0, 40), "Out", "Quad", fadeDuration)
	else
		secondBox:TweenSize(UDim2.new(0, 350, 0, 200), "Out", "Quad", fadeDuration)
	end
	isMinimized = not isMinimized
end)

-- Close functionality
closeButton.MouseButton1Click:Connect(function()
	secondBox:Destroy()
end)

-- Initial fade-in
fadeIn(dragFrame)
